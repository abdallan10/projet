from sqlalchemy import Column, Integer, String, DateTime, ForeignKey, Enum, JSON
from pentestbox.core.db import Base
import datetime

class Scan(Base):
    __tablename__ = "scans"

    id = Column(Integer, primary_key=True, index=True)
    module = Column(String, nullable=False)
    target_id = Column(Integer, ForeignKey("targets.id"))
    status = Column(
        Enum("pending", "started", "finished", "failed", name="scan_status"), nullable=False, default="pending"
    )
    owner_id = Column(Integer, ForeignKey("users.id"))
    started_at = Column(DateTime, default=datetime.datetime.utcnow)
    finished_at = Column(DateTime)
    result_path = Column(String)
    details = Column(JSON, default={})