from cryptography.fernet import Fernet
from fastapi import HTTPException, status
from pentestbox.core.config import settings


fernet = Fernet(settings.FERNET_KEY.encode())


def encrypt_secret(secret: str) -> str:
    return fernet.encrypt(secret.encode()).decode()


def decrypt_secret(token: str) -> str:
    try:
        return fernet.decrypt(token.encode()).decode()
    except Exception:
        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Invalid secret decryption")


def check_admin(role: str):
    if role != "admin":
        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Admin privilege required")

def check_analyst(role: str):
    if role not in ("admin", "analyst"):
        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Analyst privilege required")