import subprocess
from pentestbox.plugins.base import PluginBase

class GobusterPlugin(PluginBase):
    def name(self) -> str:
        return "gobuster"

    def scan(self, target: str, options: dict, output_file: str, celery_task=None) -> dict:
        wordlist = options.get("wordlist", "/usr/share/wordlists/dirb/common.txt")
        cmd = [
            "gobuster",
            "dir",
            "-u", target,
            "-w", wordlist,
            "-o", output_file,
            "--no-error",
            "-q"
        ]
        subprocess.run(cmd, check=True)
        return {"result_file": output_file}

    @classmethod
    def is_available(cls):
        try:
            subprocess.run(["gobuster", "--help"], capture_output=True)
            return True
        except Exception:
            return False